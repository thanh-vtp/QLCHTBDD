@model QLCHTBDD_62131904.Models.SanPham

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<h2 class="page-title">Thêm mới sản phẩm</h2>

<div class="add-product">
    <!-- Form nhập chính -->
    <div class="">
        @using (Html.BeginForm("Create", "SanPhams_62131904", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            @Html.AntiForgeryToken()

            @Html.ValidationSummary(true, "", new { @class = "form-error" })

            <div class="form-group">
                @Html.LabelFor(model => model.MaHang, "Hãng sản phẩm", new { @class = "" })
                @Html.DropDownList("MaHang", null, new { @class = "" })
                @Html.ValidationMessageFor(model => model.MaHang, "", new { @class = "form-error" })
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.MaLSP, "Loại sản phẩm", new { @class = "" })
                @Html.DropDownList("MaLSP",
                    new SelectList(ViewBag.MaLSP, "Value", "Text", null),
                    "Chọn loại sản phẩm",
                    new { @class = "", id = "productType" })
                @Html.ValidationMessageFor(model => model.MaLSP, "", new { @class = "form-error" })
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.TenSP, "Tên sản phẩm", new { @class = "" })
                @Html.EditorFor(model => model.TenSP, new { htmlAttributes = new { @class = "", placeholder = "Nhập tên sản phẩm" } })
                @Html.ValidationMessageFor(model => model.TenSP, "", new { @class = "form-error" })
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.MoTa, "Mô tả", new { @class = "" })
                @Html.TextAreaFor(model => model.MoTa, new { @class = "", placeholder = "Nhập mô tả", rows = "3" })
                @Html.ValidationMessageFor(model => model.MoTa, "", new { @class = "form-error" })
            </div>

            <!-- Quốc gia -->
            <div class="form-group">
                <label for="MaQG" class="">Quốc gia</label>
                @Html.DropDownList("MaQG", ViewBag.MaQG as SelectList, "Chọn quốc gia", new { @class = "" })
            </div>

            <div class="form-group">
                <label for="MaRAM" class="">RAM</label>
                @Html.DropDownList("MaRAM", ViewBag.MaRAM as SelectList, "Chọn dung lượng", new { @class = "" })
            </div>

            <div class="form-group">
                <label for="MaROM" class="">Dung lượng Lưu trữ (ROM)</label>
                @Html.DropDownList("MaROM", ViewBag.MaROM as SelectList, "Chọn dung lượng", new { @class = "" })
            </div>

            <div class="form-group">
                <label for="MaMau" class="">Màu sắc</label>
                @Html.DropDownList("MaMau", ViewBag.MaMau as SelectList, "Chọn màu sắc", new { @class = "" })
            </div>

            <div class="form-group">
                <label for="SoLuong" class="">Số lượng</label>
                <input type="number" id="SoLuong" name="SoLuong" class="" required />
            </div>

            <div class="form-group">
                <label for="DonViTinh" class="">Đơn vị tính</label>
                <select id="DonViTinh" name="DonViTinh" class="">
                    <option value="Chiếc">Chiếc</option>
                    <option value="Bộ">Bộ</option>
                </select>
            </div>

            <div class="form-group">
                <label for="DonGia" class="">Đơn giá</label>
                <input type="number" id="DonGia" name="DonGia" class="" required />
            </div>

            <!-- Upload ảnh sản phẩm -->
            <div class="form-group">
                <label for="uploadedImages" class="">Hình ảnh sản phẩm</label>
                <input type="file" id="uploadedImages" name="uploadedImages" class="" accept="image/*" multiple />
                <p class="form-group__helper-text">Chọn nhiều ảnh nếu cần (tối đa 15 ảnh).</p>
            </div>

            <!-- Form thay đổi theo loại sản phẩm -->
            <div class="add-product__form-dynamic" id="dynamicForm">
                <!-- Nội dung sẽ được thêm động qua JavaScript -->
            </div>

            <div class="form-group form-group--actions">
                <button type="submit" class="btn btn-primary">Thêm sản phẩm</button>
                @Html.ActionLink("Quay lại", "Index", null, new { @class = "btn btn-secondary" })
            </div>
        }
    </div>
</div>


<!-- Cụm ảnh dưới cùng -->
<div class="add-product__image-preview">
    <h5 class="add-product__image-preview-title">Ảnh sản phẩm đã chọn:</h5>
    <div id="imagePreviewContainer" class="add-product__image-preview-container">
        <div id="placeholderImage" class="image-placeholder">
            <span>No image selected</span>
        </div>
    </div>
</div>

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 0;
    }

    .page-title {
        text-align: center;
        font-weight: bold;
        color: #007BFF;
        margin: 20px 0;
    }

    .add-product {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin: 20px;
    }

    .form-error {
        color: red;
        font-size: 12px;
    }

    /*image */
    .image-placeholder {
        width: 180px; /* Chiều rộng hợp lý cho placeholder */
        height: 180px; /* Chiều cao hợp lý cho placeholder */
        display: flex;
        justify-content: center;
        align-items: center;
        border: 1px dashed #ccc;
        border-radius: 8px;
        color: #ccc;
        font-size: 14px;
        background-color: #f8f8f8;
    }

    .fixed-image {
        position: relative;
        display: inline-block;
        width: 180px; /* Giới hạn chiều rộng */
        height: 180px; /* Giới hạn chiều cao */
        margin: 10px;
        overflow: hidden;
        border-radius: 8px;
        border: 1px solid #ccc;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15);
    }

        .fixed-image img {
            width: 100%; /* Ảnh sẽ vừa khung */
            height: 100%; /* Ảnh sẽ vừa khung */
            object-fit: cover; /* Đảm bảo ảnh không bị méo, cắt gọn nếu cần */
            border-radius: 8px;
        }

        .fixed-image span {
            position: absolute;
            top: 8px;
            right: 8px;
            cursor: pointer;
            color: red;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.9);
            padding: 3px 8px;
            border-radius: 50%;
            font-size: 14px;
            text-align: center;
        }
</style>
<script>
    // script xử lý chọn ảnh
    document.addEventListener('DOMContentLoaded', function () {
        const imageInput = document.getElementById('uploadedImages');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const placeholderImage = document.getElementById('placeholderImage');

        let selectedFiles = [];

        imageInput.addEventListener('change', function (event) {
            const files = event.target.files;

            if (selectedFiles.length + files.length > 15) {
                alert("Bạn chỉ được tải lên tối đa 15 ảnh.");
                return;
            }

            placeholderImage.style.display = 'none';

            Array.from(files).forEach((file) => {
                if (!file.type.startsWith('image/')) {
                    alert("Chỉ được phép chọn các tệp ảnh.");
                    return;
                }

                selectedFiles.push(file);

                const reader = new FileReader();
                reader.onload = function (e) {
                    const imgContainer = document.createElement('div');
                    imgContainer.classList.add('fixed-image');

                    const img = document.createElement('img');
                    img.src = e.target.result;

                    const removeButton = document.createElement('span');
                    removeButton.innerHTML = '&#10005;';
                    removeButton.style.position = 'absolute';
                    removeButton.style.top = '5px';
                    removeButton.style.right = '5px';
                    removeButton.style.cursor = 'pointer';
                    removeButton.style.color = 'red';
                    removeButton.title = 'Xóa ảnh';

                    removeButton.addEventListener('click', function () {
                        imagePreviewContainer.removeChild(imgContainer);
                        selectedFiles = selectedFiles.filter((f) => f.name !== file.name);

                        if (selectedFiles.length === 0) {
                            placeholderImage.style.display = 'flex';
                        }

                        updateFileInput();
                    });

                    imgContainer.appendChild(img);
                    imgContainer.appendChild(removeButton);
                    imagePreviewContainer.appendChild(imgContainer);
                };
                reader.readAsDataURL(file);
            });

            updateFileInput();
        });

        // cập nhật file input
        function updateFileInput() {
            const dataTransfer = new DataTransfer();
            selectedFiles.forEach((file) => dataTransfer.items.add(file));
            imageInput.files = dataTransfer.files;
        }
    });
</script>