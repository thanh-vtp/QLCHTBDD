@model QLCHTBDD_62131904.Models.SanPham

@{
    ViewBag.Title = "Thêm mới sản phẩm";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
}
<h2 style="text-align: center; font-weight: bold; color: #007BFF;">Thêm mới sản phẩm</h2>
<div class="container" style="margin-top: 20px; display: flex; justify-content: space-between;">

    <!-- Cụm ảnh nằm bên trái -->
    <div style="width: 40%; padding: 20px; border-radius: 10px; background-color: #f9f9f9;">
        <div id="imagePreview">
            <h5 style="font-weight: bold; color: #007BFF">Ảnh sản phẩm đã chọn:</h5>
            <div id="second-avatar" style="display: flex; flex-wrap: wrap; gap: 10px;">
                <div id="placeholder-second" class="fixed-second-size-placeholder">
                    <span style="color: #ccc;">No image selected</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Form tạo sản phẩm -->
    <div style="width: 55%; padding: 20px; border-radius: 10px; background-color: #f9f9f9;">
        @using (Html.BeginForm("Create", "SanPhams_62131904", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            @Html.AntiForgeryToken()

            <div style="margin: 10px 0;">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            </div>

            <div style="margin-bottom: 15px;">
                @Html.LabelFor(model => model.MaLSP, "Loại sản phẩm", new { style = "font-weight: bold;" })
                @Html.DropDownList("MaLSP", null, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.MaLSP, "", new { @class = "text-danger" })
            </div>

            <div style="margin-bottom: 15px;">
                @Html.LabelFor(model => model.TenSP, "Tên sản phẩm", new { style = "font-weight: bold;" })
                @Html.EditorFor(model => model.TenSP, new { htmlAttributes = new { @class = "form-control", placeholder = "Nhập tên sản phẩm" } })
                @Html.ValidationMessageFor(model => model.TenSP, "", new { @class = "text-danger" })
            </div>

            <div style="margin-bottom: 15px;">
                @Html.LabelFor(model => model.MoTa, "Mô tả", new { style = "font-weight: bold;" })
                @Html.EditorFor(model => model.MoTa, new { htmlAttributes = new { @class = "form-control", placeholder = "Nhập mô tả" } })
                @Html.ValidationMessageFor(model => model.MoTa, "", new { @class = "text-danger" })
            </div>

            <div style="margin-bottom: 15px;">
                <label for="MaMau" style="font-weight: bold;">Màu sắc</label>
                @Html.DropDownList("MaMau", (SelectList)ViewBag.MaMau, "Chọn màu sắc", new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.MaLSP, "", new { @class = "text-danger" })
            </div>

            <div class="form-group">
                <label for="soLuong">Số lượng</label>
                <input type="number" id="soLuong" name="soLuong" class="form-control" required />
            </div>

            <div class="form-group">
                <label for="donViTinh">Đơn vị tính</label>
                <select id="donViTinh" name="donViTinh" class="form-control">
                    <option value="Cái">Cái</option>
                    <option value="Bộ">Bộ</option>
                </select>
            </div>

            <div class="form-group">
                <label for="donGia">Đơn giá</label>
                <input type="number" id="donGia" name="donGia" class="form-control" required />
            </div>

            <div class="form-group">
                <label for="MaROM">Dung lượng ROM</label>
                @Html.DropDownList("maRom", ViewBag.MaROM as SelectList, "Chọn dung lượng", new { @class = "form-control" })
            </div>

            <div style="margin-bottom: 15px;">
                <label for="manHinh" style="font-weight: bold;">Màn hình</label>
                <input type="text" name="manHinh" class="form-control" placeholder="Nhập thông tin màn hình" />
            </div>

            <div style="margin-bottom: 15px;">
                <label for="camera" style="font-weight: bold;">Camera</label>
                <input type="text" name="camera" class="form-control" placeholder="Nhập thông tin camera" />
            </div>

            <div style="margin-bottom: 15px;">
                <label for="pin" style="font-weight: bold;">Pin</label>
                <input type="text" name="pin" class="form-control" placeholder="Nhập dung lượng pin" />
            </div>

            <div style="margin-bottom: 15px;">
                <label for="chipset" style="font-weight: bold;">Chipset</label>
                <input type="text" name="chipset" class="form-control" placeholder="Nhập thông tin chipset" />
            </div>

            <div style="margin-bottom: 15px;">
                <label for="ram" style="font-weight: bold;">RAM</label>
                <input type="text" name="ram" class="form-control" placeholder="Nhập dung lượng RAM" />
            </div>

            <div style="margin-bottom: 15px;">
                <label for="heDieuHanh" style="font-weight: bold;">Hệ điều hành</label>
                <input type="text" name="heDieuHanh" class="form-control" placeholder="Nhập hệ điều hành" />
            </div>

            <!-- Trường chọn ảnh -->
            <div style="margin-bottom: 15px;">
                <label for="hinhAnh" style="font-weight: bold;">Hình ảnh sản phẩm</label>
                <input type="file" name="hinhAnh" class="form-control" accept="image/*" multiple onchange="previewAdditionalImages(event)" />
                <p style="color: #007BFF; font-size: 12px;">Chọn nhiều ảnh nếu cần.</p>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" class="btn btn-primary" style="padding: 10px 15px; margin-right: 10px;">Thêm sản phấm</button>
                @Html.ActionLink("Quay lại", "Index", null, new { @class = "btn btn-secondary", style = "padding: 10px 15px;" })
            </div>
        }
    </div>
</div>

<script>
    // Mảng để lưu trữ các file đã chọn
    let selectedFiles = [];

    // Preview ảnh phụ khi chọn
    function previewAdditionalImages(event) {
        const previewImages = document.getElementById('second-avatar');
        let placeholder = document.getElementById('placeholder-second');

        // Nếu không có placeholder, tạo mới
        if (!placeholder) {
            placeholder = document.createElement('div');
            placeholder.id = 'placeholder-second';
            placeholder.classList.add('fixed-second-size-placeholder');
            placeholder.innerHTML = '<span style="color: #ccc;">No image selected</span>';
            previewImages.appendChild(placeholder);
        }

        const files = event.target.files;

        if (files.length > 0) {
            // Lưu các file vào mảng selectedFiles
            Array.from(files).forEach(file => {
                selectedFiles.push(file);
            });

            // Nếu có file, giữ placeholder nhưng đảm bảo nó luôn ở cuối
            placeholder.style.display = 'none'; // Ẩn tạm placeholder

            for (const file of files) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    // Tạo container chứa ảnh và nút xóa
                    const imgContainer = document.createElement('div');
                    imgContainer.style.position = 'relative'; // Để đặt nút xóa lên ảnh
                    imgContainer.style.display = 'inline-block';
                    imgContainer.style.margin = '5px';

                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.classList.add('fixed-second-size-image');

                    // Tạo nút xóa (icon "x")
                    const removeButton = document.createElement('span');
                    removeButton.innerHTML = '&#10005;'; // Biểu tượng xóa (x)
                    removeButton.style.position = 'absolute';
                    removeButton.style.top = '10px';
                    removeButton.style.right = '10px';
                    removeButton.style.fontSize = '20px';
                    removeButton.style.color = 'red';
                    removeButton.style.cursor = 'pointer';
                    removeButton.title = 'Xóa hình ảnh';
                    removeButton.onclick = function () {
                        // Xóa ảnh khi nhấn nút x
                        previewImages.removeChild(imgContainer);

                        // Cập nhật lại mảng selectedFiles bằng cách loại bỏ file đã xóa
                        selectedFiles = selectedFiles.filter(f => f.name !== file.name);

                        // Hiển thị lại placeholder nếu không còn ảnh nào
                        if (previewImages.querySelectorAll('.fixed-second-size-image').length === 0) {
                            placeholder.style.display = 'flex';
                        }

                        // Cập nhật lại giá trị input file (xóa file đã xóa khỏi input)
                        updateFileInput();
                    };

                    // Thêm ảnh và nút xóa vào container
                    imgContainer.appendChild(img);
                    imgContainer.appendChild(removeButton);

                    // Thêm ảnh vào trước placeholder
                    previewImages.insertBefore(imgContainer, placeholder);
                };
                reader.readAsDataURL(file);
            }

            // Đảm bảo placeholder luôn ở cuối
            placeholder.style.display = 'flex'; // Hiện lại placeholder sau khi thêm ảnh
        } else {
            // Nếu không có file, hiển thị lại placeholder
            placeholder.style.display = 'flex';
        }

        // Cập nhật lại giá trị input file
        updateFileInput();
    }

    // Hàm để cập nhật giá trị input file khi xóa ảnh
    function updateFileInput() {
        const fileInput = document.querySelector('input[name="HinhAnh"]');

        // Tạo lại một input file mới (reset)
        const newInput = document.createElement('input');
        newInput.type = 'file';
        newInput.name = 'HinhAnh';
        newInput.classList.add('form-control');
        newInput.accept = 'image/*';
        newInput.multiple = true;
        newInput.onchange = previewAdditionalImages;

        // Duy trì các file còn lại trong mảng selectedFiles
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => {
            dataTransfer.items.add(file);
        });

        // Gán lại các file vào input file mới
        newInput.files = dataTransfer.files;

        // Thay thế input cũ bằng input mới
        fileInput.parentNode.replaceChild(newInput, fileInput);
    }
</script>


<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 0;
    }

    #second-avatar {
        margin-bottom: 20px;
    }

    .fixed-second-size-image {
        max-width: 100px;
        height: auto;
        object-fit: cover;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .fixed-second-size-placeholder {
        width: 100px;
        height: 75px;
        display: flex;
        text-align: center;
        align-items: center;
        justify-content: center;
        border: 1px dashed #ccc;
        border-radius: 5px;
        color: #ccc;
        font-size: 12px;
    }
</style>
